<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Multi-room Chat (GitHub Pages)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --bg:#0f0f12;--panel:#15151b;--muted:#9aa0a6;--card:#1a1a22;--border:#252533;--accent:#4ea3ff;
    }
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Arial;background:var(--bg);color:#eaeaf2}
    .app{display:grid;grid-template-columns:260px 1fr;height:100vh}
    .sidebar{padding:14px;background:var(--panel);border-right:1px solid var(--border);display:flex;flex-direction:column;gap:12px}
    .section{display:flex;flex-direction:column;gap:6px}
    input,button,select{background:var(--card);color:inherit;border:1px solid #272734;border-radius:8px;padding:8px 10px}
    button{cursor:pointer}
    .rooms{display:flex;flex-direction:column;gap:6px;max-height:30vh;overflow:auto}
    .main{display:grid;grid-template-rows:auto 1fr auto}
    .header{padding:12px 16px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}
    .messages{padding:16px;overflow:auto;display:flex;flex-direction:column;gap:10px;background:linear-gradient(180deg,#0f0f12,transparent)}
    .msg{max-width:70%;background:var(--card);border:1px solid #262636;padding:10px;border-radius:10px}
    .meta{font-size:12px;color:var(--muted);margin-bottom:6px}
    .composer{display:grid;grid-template-columns:1fr auto;gap:10px;padding:12px 16px;border-top:1px solid var(--border);align-items:center;background:var(--panel)}
    .system{align-self:center;font-size:12px;color:var(--muted);padding:6px 10px;border-radius:999px;border:1px dashed #272734;background:#15151b}
    small.hint{color:var(--muted);display:block;margin-top:6px}
    .room-btn{display:flex;justify-content:space-between;align-items:center;padding:7px 10px;border-radius:8px;border:1px solid #272734;background:transparent}
    .room-btn:hover{outline:1px solid rgba(78,163,255,0.12)}
    .selected{outline:2px solid rgba(78,163,255,0.14)}
  </style>
</head>
<body>
  <div class="app">
    <aside class="sidebar">
      <div class="section">
        <label>Server URL</label>
        <input id="server" placeholder="wss://your-server.example" />
        <small class="hint">Must be <strong>wss://</strong> for GitHub Pages (HTTPS)</small>
      </div>

      <div class="section">
        <label>Username</label>
        <input id="username" placeholder="Cameron" />
        <div style="display:flex;gap:8px;margin-top:6px">
          <button id="connect">Connect</button>
          <button id="disconnect" disabled>Disconnect</button>
        </div>
      </div>

      <div class="section">
        <label>Join room</label>
        <input id="roomJoin" placeholder="room name (e.g. general)" />
        <input id="roomJoinPwd" placeholder="password (optional)" />
        <button id="join">Join</button>
      </div>

      <div class="section">
        <label>Create room</label>
        <input id="roomCreate" placeholder="new room name" />
        <input id="roomCreatePwd" placeholder="password (optional)" />
        <button id="create">Create</button>
      </div>

      <div class="section">
        <label>Public Rooms</label>
        <div id="rooms" class="rooms"></div>
        <div style="display:flex;gap:8px;margin-top:6px">
          <button id="refreshRooms">Refresh</button>
          <button id="leave" disabled>Leave</button>
        </div>
      </div>
    </aside>

    <main class="main">
      <div class="header">
        <div>Room: <strong id="currentRoom">none</strong></div>
        <div>Status: <strong id="status">disconnected</strong></div>
      </div>

      <div id="messages" class="messages"></div>

      <div class="composer">
        <input id="text" placeholder="Type a message..." />
        <div style="display:flex;gap:8px">
          <button id="send">Send</button>
        </div>
      </div>
    </main>
  </div>

  <script>
    // Minimal client that expects server messages:
    // { type: 'system'|'rooms'|'joined'|'chat'|'error', ... }
    let ws = null;
    let me = { username: 'Anon', room: null };

    const els = {
      server: document.getElementById('server'),
      username: document.getElementById('username'),
      connect: document.getElementById('connect'),
      disconnect: document.getElementById('disconnect'),
      roomJoin: document.getElementById('roomJoin'),
      roomJoinPwd: document.getElementById('roomJoinPwd'),
      roomCreate: document.getElementById('roomCreate'),
      roomCreatePwd: document.getElementById('roomCreatePwd'),
      join: document.getElementById('join'),
      create: document.getElementById('create'),
      refreshRooms: document.getElementById('refreshRooms'),
      rooms: document.getElementById('rooms'),
      status: document.getElementById('status'),
      currentRoom: document.getElementById('currentRoom'),
      messages: document.getElementById('messages'),
      text: document.getElementById('text'),
      send: document.getElementById('send'),
      leave: document.getElementById('leave'),
    };

    function setStatus(t){ els.status.textContent = t; }
    function setRoom(r){ els.currentRoom.textContent = r || 'none'; }
    function addSystem(t){
      const d = document.createElement('div'); d.className='system'; d.textContent=t;
      els.messages.appendChild(d); els.messages.scrollTop = els.messages.scrollHeight;
    }
    function addMessage({username,text,ts,room}){
      const wrap = document.createElement('div'); wrap.className='msg';
      const meta = document.createElement('div'); meta.className='meta';
      meta.textContent = (username||'') + ' • ' + new Date(ts||Date.now()).toLocaleTimeString() + ' • #' + (room||'');
      const body = document.createElement('div'); body.textContent = text;
      wrap.appendChild(meta); wrap.appendChild(body); els.messages.appendChild(wrap);
      els.messages.scrollTop = els.messages.scrollHeight;
    }
    function renderRooms(list){
      els.rooms.innerHTML = '';
      (list||[]).forEach(r=>{
        const btn = document.createElement('button'); btn.className='room-btn'; btn.innerText = r;
        btn.onclick = ()=>{ els.roomJoin.value = r; els.roomJoinPwd.value=''; };
        els.rooms.appendChild(btn);
      });
    }

    function connect(){
      const url = els.server.value.trim();
      if (!url) return alert('Enter the WebSocket URL (wss://...)');
      me.username = els.username.value.trim() || 'Anon';
      try { ws = new WebSocket(url); } catch(e){ setStatus('bad url'); return; }
      setStatus('connecting');
      ws.onopen = ()=>{ setStatus('connected'); ws.send(JSON.stringify({type:'hello', username:me.username})); els.connect.disabled=true; els.disconnect.disabled=false; addSystem('Connected'); };
      ws.onmessage = (evt)=> {
        let pkt; try{ pkt = JSON.parse(evt.data); }catch(e){ return; }
        if (pkt.type === 'system') addSystem(pkt.text);
        else if (pkt.type === 'rooms') renderRooms(pkt.rooms);
        else if (pkt.type === 'joined'){ me.room = pkt.room; setRoom(me.room); addSystem('Joined '+me.room); els.leave.disabled=false; }
        else if (pkt.type === 'left'){ me.room = null; setRoom(null); addSystem('Left room'); els.leave.disabled=true; }
        else if (pkt.type === 'chat') addMessage(pkt);
        else if (pkt.type === 'error') addSystem('Error: '+pkt.text);
      };
      ws.onclose = ()=>{ setStatus('disconnected'); els.connect.disabled=false; els.disconnect.disabled=true; addSystem('Disconnected'); };
      ws.onerror = ()=>{ setStatus('error'); addSystem('Connection error'); };
    }

    function disconnect(){ if (ws){ ws.close(); ws=null; } }

    function joinRoom(){ if (!ws||ws.readyState!==WebSocket.OPEN) return; const room = els.roomJoin.value.trim()||'general'; const pwd = els.roomJoinPwd.value.trim(); ws.send(JSON.stringify({type:'join', room, password:pwd})); }
    function createRoom(){ if (!ws||ws.readyState!==WebSocket.OPEN) return; const room = els.roomCreate.value.trim()||'newroom'; const pwd = els.roomCreatePwd.value.trim(); ws.send(JSON.stringify({type:'create', room, password:pwd})); }
    function leaveRoom(){ if (!ws||ws.readyState!==WebSocket.OPEN) return; ws.send(JSON.stringify({type:'leave'})); }
    function refreshRooms(){ if (!ws||ws.readyState!==WebSocket.OPEN) return; ws.send(JSON.stringify({type:'rooms'})); }
    function sendChat(){ if (!ws||ws.readyState!==WebSocket.OPEN) return; if (!me.room) return alert('Join a room first'); const text = els.text.value.trim(); if (!text) return; ws.send(JSON.stringify({type:'chat', text, room:me.room})); els.text.value=''; }

    // bindings
    els.connect.onclick = connect; els.disconnect.onclick = disconnect;
    els.join.onclick = joinRoom; els.create.onclick = createRoom; els.refreshRooms.onclick = refreshRooms;
    els.send.onclick = sendChat; els.leave.onclick = leaveRoom;
    els.text.addEventListener('keypress', (e)=>{ if (e.key === 'Enter') sendChat(); });

    // try load saved server+username from localStorage
    try {
      const s = localStorage.getItem('chat:server'); if (s) els.server.value = s;
      const u = localStorage.getItem('chat:username'); if (u) els.username.value = u;
    }catch(e){}
    // persist on change
    els.server.addEventListener('change', ()=> localStorage.setItem('chat:server', els.server.value));
    els.username.addEventListener('change', ()=> localStorage.setItem('chat:username', els.username.value));
  </script>
</body>
</html>
